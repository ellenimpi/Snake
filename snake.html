<!DOCTYPE html>
<html>
  <head>
    <title>Snake Game</title>
  </head>
  <body>
    <div id="score">0</div>
    <canvas id="gameCanvas" width="300" height="300"></canvas>

    <script>
      //var is accessed globally while let is not - let is used in for loops etc.
      //constant variables
      const CANVAS_BORDER_COLOUR = "black";
      const CANVAS_BACKGROUND_COLOUR = "white";
      const SNAKE_BODY = "lightgreen";
      const SNAKE_LINES = "darkgreen";
      const FOOD_COLOUR = "red";
      const FOOD_BORDER_COLOUR = "darkred";

      //array representing the snake
      let snake = [
        { x: 150, y: 150 },
        { x: 140, y: 150 },
        { x: 130, y: 150 },
        { x: 120, y: 150 },
        { x: 110, y: 150 }
      ];

      let score = 0;
      let foodX;
      let foodY;
      let dx = 10;
      let dy = 0;

      //draws and fills game canvas
      var gameCanvas = document.getElementById("gameCanvas");
      var ctx = gameCanvas.getContext("2d");

      ctx.fillStyle = CANVAS_BACKGROUND_COLOUR;
      ctx.strokestyle = CANVAS_BORDER_COLOUR;
      ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
      ctx.strokeRect(0, 0, gameCanvas.width, gameCanvas.height);

      move();
      createFood();
      document.addEventListener("keydown", changeDirection);

      function move() {
        if (gameEnd()) return;

        setTimeout(function onTick() {
          clearCanvas();
          drawSnake();
          drawFood();
          moveSnake();

          move();
        }, 100);
      }

      function clearCanvas() {
        ctx.fillStyle = CANVAS_BACKGROUND_COLOUR;
        ctx.strokeStyle = CANVAS_BORDER_COLOUR;
        ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
        ctx.strokeRect(0, 0, gameCanvas.width, gameCanvas.height);
      }

      function gameEnd() {
        for (let i = 4; i < snake.length; i++) {
          if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
            return true;
          }
        }

        //if the snake touches any of the walls
        const hitLeftWall = snake[0].x < 0;
        const hitRightWall = snake[0].x > gameCanvas.width - 10;
        const hitToptWall = snake[0].y < 0;
        const hitBottomWall = snake[0].y > gameCanvas.height - 10;
        return hitLeftWall || hitRightWall || hitToptWall || hitBottomWall;
      }

      function drawFood() {
        ctx.fillStyle = FOOD_COLOUR;
        ctx.strokeStyle = FOOD_BORDER_COLOUR;
        ctx.fillRect(foodX, foodY, 10, 10);
        ctx.strokeRect(foodX, foodY, 10, 10);
      }

      //if it eats food, it will not pop the end off
      function moveSnake() {
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };
        snake.unshift(head); //adds head to the end

        if (snake[0].x === foodX && snake[0].y === foodY) {
          score += 10;
          document.getElementById("score").innerHTML = score;
          createFood();
        } else {
          snake.pop();
        }
      }

      function randomGen(min, max) {
        return Math.round((Math.random() * (max - min) + min) / 10) * 10;
      }

      function createFood() {
        //randomly generates location for the food
        foodX = randomGen(0, gameCanvas.width - 10);
        foodY = randomGen(0, gameCanvas.height - 10);

        //for each component we check to see if food generated on top
        snake.forEach(function snakeOnFood(part) {
          if (part.x == foodX && part.y == foodY) createFood();
        });
      }

      function drawSnake() {
        snake.forEach(drawSnakeSquare);
      }

      function drawSnakeSquare(snakeSquare) {
        ctx.fillStyle = "lightgreen";
        ctx.strokeStyle = "darkgreen";
        ctx.fillRect(snakeSquare.x, snakeSquare.y, 10, 10);
        ctx.strokeRect(snakeSquare.x, snakeSquare.y, 10, 10);
      }

      function changeDirection(event) {
        const LEFT = 37;
        const RIGHT = 39;
        const UP = 38;
        const DOWN = 40;

        const keyPress = event.keyCode; //code will be a number like 38 or 37 or whatever
        const GOINGUP = dy === -10;
        const GOINGRIGHT = dx === 10;
        const GOINGDOWN = dy === 10;
        const GOINGLEFT = dx === -10;

        if (keyPress === LEFT && !GOINGRIGHT) {
          dx = -10;
          dy = 0;
        }
        if (keyPress === RIGHT && !GOINGLEFT) {
          dx = 10;
          dy = 0;
        }
        if (keyPress === UP && !GOINGDOWN) {
          dy = -10;
          dx = 0;
        }
        if (keyPress === DOWN && !GOINGUP) {
          dy = 10;
          dx = 0;
        }
      }
    </script>
  </body>
</html>
